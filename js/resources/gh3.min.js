(function(){var j=this,a,i,l,c,k,g,d,b,f;if(typeof exports!=="undefined"){a=exports}else{a=j.Gh3={}}a.VERSION="0.0.7";i=function(){};i.inherits=function(m,e,o){var q,n=function(){},p=function(r,s){for(var t in s){r[t]=s[t]}};if(e&&e.hasOwnProperty("constructor")){q=e.constructor}else{q=function(){m.apply(this,arguments)}}p(q,m);n.prototype=m.prototype;q.prototype=new n();if(e){p(q.prototype,e)}if(o){p(q,o)}q.prototype.constructor=q;q.__super__=m.prototype;return q};i.extend=function(e,m){var n=i.inherits(this,e,m);n.extend=this.extend;return n};if(!j.Base64){f={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decode:function(n){var e="";var u,s,q;var t,r,p,o;var m=0;n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(m<n.length){t=this._keyStr.indexOf(n.charAt(m++));r=this._keyStr.indexOf(n.charAt(m++));p=this._keyStr.indexOf(n.charAt(m++));o=this._keyStr.indexOf(n.charAt(m++));u=(t<<2)|(r>>4);s=((r&15)<<4)|(p>>2);q=((p&3)<<6)|o;e=e+String.fromCharCode(u);if(p!=64){e=e+String.fromCharCode(s)}if(o!=64){e=e+String.fromCharCode(q)}}e=f._utf8_decode(e);return e},encode:function(n){var e="";var u,s,q,t,r,p,o;var m=0;n=f._utf8_encode(n);while(m<n.length){u=n.charCodeAt(m++);s=n.charCodeAt(m++);q=n.charCodeAt(m++);t=u>>2;r=((u&3)<<4)|(s>>4);p=((s&15)<<2)|(q>>6);o=q&63;if(isNaN(s)){p=o=64}else{if(isNaN(q)){o=64}}e=e+this._keyStr.charAt(t)+this._keyStr.charAt(r)+this._keyStr.charAt(p)+this._keyStr.charAt(o)}return e},_utf8_decode:function(e){var m="";var n=0;var o=c1=c2=0;while(n<e.length){o=e.charCodeAt(n);if(o<128){m+=String.fromCharCode(o);n++}else{if((o>191)&&(o<224)){c2=e.charCodeAt(n+1);m+=String.fromCharCode(((o&31)<<6)|(c2&63));n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);m+=String.fromCharCode(((o&15)<<12)|((c2&63)<<6)|(c3&63));n+=3}}}return m},_utf8_encode:function(m){m=m.replace(/\r\n/g,"\n");var e="";for(var p=0;p<m.length;p++){var o=m.charCodeAt(p);if(o<128){e+=String.fromCharCode(o)}else{if((o>127)&&(o<2048)){e+=String.fromCharCode((o>>6)|192);e+=String.fromCharCode((o&63)|128)}else{e+=String.fromCharCode((o>>12)|224);e+=String.fromCharCode(((o>>6)&63)|128);e+=String.fromCharCode((o&63)|128)}}}return e}};j.Base64=f}a.Base64=j.Base64;if(window.XDomainRequest){try{new XDomainRequest();$.support.cors=true;$.ajaxSetup.xhr=function(){return new XDomainRequest()}}catch(h){}}a.Helper=i.extend({},{protocol:"https",domain:"api.github.com",headers:{Origin:location.host,Accept:"application/vnd.github+json","Content-Type":"application/json"},dataType:"json",cache:true,callHttpApi:function(e){e.url=a.Helper.protocol+"://"+a.Helper.domain+"/"+e.service;if($.support.cors){e.headers=$.extend({},a.Helper.headers,e.headers||{});if(!e.dataType){e.dataType=a.Helper.dataType}if(!e.cache&&e.cache!==false){e.cache=a.Helper.cache}var m=e.success;if($.isFunction(m)){e.success=function(o,p,n){m.call(this,{data:o},p,n)}}}else{e.dataType="jsonp"}$.ajax(e)}});l=i.extend({_call:function(n,e){var m=$.extend({},e||{},{type:n,service:this._service()});a.Helper.callHttpApi(m)},check:function(m,e){this._call("GET",{success:function(){m(true)},error:function(n){if(n.status==404){m(false)}else{e(n)}}})},set:function(m,e){this._call("PUT",{success:m,error:e})},unset:function(m,e){this._call("DELETE",{success:m,error:e})}});a.Star=l.extend({constructor:function(e){this.repository=e},_service:function(){return"user/starred/"+this.repository.path()}});a.Watching=l.extend({constructor:function(e){this.repository=e},_service:function(){return"user/subscriptions/"+this.repository.path()}});a.Following=l.extend({constructor:function(e){this.user=e},_service:function(){return"user/following/"+this.user.login}});d=i.extend({constructor:function(){this.fetched=false},_setData:function(e){if(!e){return}for(var m in e){this[m]=e[m]}},_onFetchSuccess:function(m,e){this.fetched=true;if(m){m(null,this)}},_onFetchError:function(m,e){if(m){m(e)}},_service:function(){throw ("Undefined service")},_defaultFetchCallParams:function(){return{}},_preFetch:function(m,e){},fetch:function(q,m){var n=this,e,p,o;n._preFetch(q,m);p={service:n._service(),success:function(r){n._onFetchSuccess(q,r)},error:function(r){n._onFetchError(q,r)}};e=n._defaultFetchCallParams();if(m){e.data=$.extend({},e.data||{},m)}a.Helper.callHttpApi($.extend({},e,p))}});g=d.extend({constructor:function(e){g.__super__.constructor.call(this);this._setData(e)},_onFetchSuccess:function(m,e){this._setData(e.data);g.__super__._onFetchSuccess.call(this,m,e)}});c={};c._Base=d.extend({constructor:function(e){this.parent=e;this.list=[];c._Base.__super__.constructor.call(this)},length:function(){return this.list.length},reverse:function(){this.list.reverse()},sort:function(e){if(e){this.list.sort(e)}else{this.list.sort()}},getAll:function(){return this.list},filterBy:function(m,e){return _.filter(this.list,function(n){return n[m]==e},this)},getBy:function(m,e){return _.find(this.list,function(n){return n[m]==e},this)},getByName:function(e){return this.getBy("name",e)},each:function(e){_.each(this.list,e)},_onFetchSuccess:function(m,e){this.fetched=true;this._setItems(e.data);if(m){m(null,this.parent)}},_prepareItem:function(e){return e},_addItem:function(e){this.list.push(this._prepareItem(e))},_addItems:function(e){var m=this;_.each(e,function(n){m._addItem(n)})},_setItems:function(e){this.list=[];this._addItems(e)}});a.User=g.extend({constructor:function(e,m){if(e){this.login=e}else{throw"login !"}a.User.__super__.constructor.call(this,m);this.repositories=new c.UserRepositories(this);this.members=new c.OrganizationMembers(this);this.orgs=new c.UserOrganizations(this);this.followers=new c.UserFollowers(this);this.following=new c.UserFollowing(this);this.starred=new c.UserStarredRepositories(this);this.events=new c.UserEvents(this);this.received_events=new c.UserReceivedEvents(this);this.gists=new c.UserGists(this)},_service:function(){return"users/"+this.login},_setData:function(e){if(e){if(typeof e.followers!=="undefined"){e.followers_count=e.followers;delete e.followers}if(typeof e.following!=="undefined"){e.following_count=e.following;delete e.following}}a.User.__super__._setData.call(this,e)}});c._UsersList=c._Base.extend({_prepareItem:function(e){return new a.User(e.login,e)},getByLogin:function(e){return this.getBy("login",e)}});c.OrganizationMembers=c._UsersList.extend({_service:function(){return"orgs/"+this.parent.login+"/members"}});c.UserOrganizations=c._UsersList.extend({_service:function(){return this.parent._service()+"/orgs"}});c.UserFollowers=c._UsersList.extend({_service:function(){return this.parent._service()+"/followers"}});c.UserFollowing=c._UsersList.extend({_service:function(){return this.parent._service()+"/following"}});c.RepositoryContributors=c._UsersList.extend({_service:function(){return this.parent._service()+"/contributors"}});c.RepositoryStargazers=c._UsersList.extend({_service:function(){return this.parent._service()+"/stargazers"}});a.CurrentUser=a.User.extend({constructor:function(){a.CurrentUser.__super__.constructor.call(this,"logged-user")},_service:function(){return"user"}});a.Event=g.extend({_setData:function(e){if(e){if(e.actor){if(e.actor.id&&e.actor.login){if(!this.actor){this.actor=new a.User(e.actor.login)}this.actor._setData(e.actor)}delete e.actor}if(e.repo){if(e.repo.id&&e.repo.name){if(!this.repository){var m=e.repo.name.split("/");this.repository=new a.Repository(m[1],new a.User(m[0]))}this.repository._setData(e.repo)}delete e.repo}}a.Event.__super__._setData.call(this,e)}});c._EventsList=c._Base.extend({_prepareItem:function(e){return new a.Event(e)}});c.UserEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/events"}});c.UserReceivedEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/received_events"}});c.RepositoryEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/events"}});a.Gist=g.extend({constructor:function(o,n,m,e){this.user=n||null;this.parent=m||null;this.version=e||null;this.files=new c.GistFiles(this);this.comments=new c.GistComments(this);this.forks=new c.GistForks(this);this.history=new c.GistHistory(this);a.Gist.__super__.constructor.call(this,o)},_setData:function(e){if(e.user){if(!this.user){this.user=new a.User(e.user.login)}this.user._setData(e.user);delete e.user}if(e.files){this.files._setItems(e.files);delete e.files}if(e.fork_of){if(!this.parent){this.parent=new a.Gist({id:e.fork_of.id},new a.User(e.fork_of.user.login,e.fork_of.user))}this.parent._setData(e.fork_of);delete e.fork_of}if(e.forks){this.history._setItems(e.forks);delete e.forks}if(e.history){this.history._setItems(e.history);delete e.history}e.comment_count=e.comments;delete e.comments;a.Gist.__super__._setData.call(this,e)},_baseService:function(){return"gists/"+this.id},_service:function(){var e=this._baseService();if(this.version){e+="/"+this.version}return e}});a.GistComment=g.extend({constructor:function(m,e){this.gist=e;a.GistComment.__super__.constructor.call(this,m)},_service:function(){return this.gist._baseService()+"/comments/"+this.id},_setData:function(e){if(e.user){if(!this.user){this.user=new a.User(e.user.login)}this.user._setData(e.user);delete e.user}a.GistComment.__super__._setData.call(this,e)}});c.GistComments=c._Base.extend({_prepareItem:function(e){return new a.GistComment(e,this.parent)},_service:function(){return this.parent._baseService()+"/comments"}});c.GistForks=c._Base.extend({_prepareItem:function(m){var e;if(m.user){e=new a.User(m.user.login,m.user)}return new a.Gist(m,e,this.parent)},_service:function(){return this.parent._baseService()+"/forks"}});c.UserGists=c._Base.extend({_prepareItem:function(e){return new a.Gist(e,this.parent)},_service:function(){return this.parent._service()+"/gists"}});a.GistFile=g.extend({constructor:function(e,m){this.gist=m;a.GistFile.__super__.constructor.call(this,e)}});c.GistFiles=c._Base.extend({_prepareItem:function(e){return new a.GistFile(e,this.parent)},getByName:function(e){return this.getBy("filename",e)}});a.GistVersion=g.extend({constructor:function(e,n,m){this.parent=m;this.version=e;this.gist=new a.Gist({id:this.parent.id},this.parent.user,null,this.version);a.GistVersion.__super__.constructor.call(this,n)}});c.GistHistory=c._Base.extend({_prepareItem:function(e){return new a.GistVersion(e.version,e,this.parent)}});k=g.extend({constructor:function(e,m){this.branch=m;k.__super__.constructor.call(this,e)},_service:function(){return this.branch.repository._service()+"/contents/"+this.path}});a.File=k.extend({constructor:function(e,m){a.File.__super__.constructor.call(this,e,m);this.commits=new c.FileCommits(this)},_service:function(){return this.branch.repository._service()+"/contents/"+this.path},_defaultFetchCallParams:function(){var e=c.ItemContents.__super__._defaultFetchCallParams.call(this);e.data=$.extend({},e.data||{},{ref:this.branch.name});return e},_onFetchSuccess:function(m,e){if(e.data.content){e.data.content=f.decode(e.data.content)}a.File.__super__._onFetchSuccess.call(this,m,e)}});a.Dir=k.extend({constructor:function(e,m){a.Dir.__super__.constructor.call(this,e,m);this.contents=new c.ItemContents(this)}});c.ItemContents=c._Base.extend({_prepareItem:function(e){return new a[e.type=="file"?"File":"Dir"](e,this.parent)},_service:function(){return this.parent.branch.repository._service()+"/contents/"+this.parent.path},_defaultFetchCallParams:function(){var e=c.ItemContents.__super__._defaultFetchCallParams.call(this);e.data=$.extend({},e.data||{},{ref:this.parent.branch.name});return e},files:function(e){return _.filter(this.list,function(m){return m.type=="file"},this)},dirs:function(e){return _.filter(this.list,function(m){return m.type=="dir"},this)},getFileByName:function(e){return _.find(this.list,function(m){return m.name==e&&m.type=="file"})},getDirByName:function(e){return _.find(this.list,function(m){return m.name==e&&m.type=="dir"})}});a.Commit=g.extend({constructor:function(m,e){this.branch=e;this.files=new c.CommitFiles(this);a.Commit.__super__.constructor.call(this,m)},_setData:function(e){if(e.author){if(!this.author){this.author=new a.User(e.author.login)}this.author._setData(e.author);delete e.author}if(e.commiter){if(!this.author||e.commiter.login!=this.author.login){if(!this.commiter){this.commiter=new a.User(e.commiter.login)}this.commiter._setData(e.commiter)}else{this.commiter=this.author}delete e.commiter}if(e.files){this.files._setItems(e.files);delete e.files}a.Commit.__super__._setData.call(this,e)}});a.CommitFile=g.extend({constructor:function(e,m){this.commit=m;a.CommitFile.__super__.constructor.call(this,e)},_setData:function(m){var e={sha:m.sha,filename:m.filename};if(!this.file){this.file=new a.File(e,this.commit.branch)}else{this.file._setData(e)}a.CommitFile.__super__._setData.call(this,m)}});c.CommitFiles=c._Base.extend({_prepareItem:function(e){return new a.CommitFile(e,this.parent)},getByName:function(e){return this.getBy("filename",e)}});c._Commits=c._Base.extend({_service:function(){return this.parent.branch.repository._service()+"/commits"},_prepareItem:function(e){return new a.Commit(e,this.parent.branch)},last:function(){return this.list[0]},first:function(){return this.list[this.list.length-1]}});c.FileCommits=c._Commits.extend({_defaultFetchCallParams:function(n,e){var m=c.FileCommits.__super__._defaultFetchCallParams.call(this,n,e);m.data=$.extend({},m.data||{},{path:this.parent.path});return m}});c.BranchCommits=c._Commits.extend({_defaultFetchCallParams:function(n,e){var m=c.FileCommits._defaultFetchCallParams.call(this,n,e);m.data=$.extend({},m.data||{},{ref:this.parent.name});return m}});a.Branch=g.extend({constructor:function(m,e){this.repository=e;this.branch=this;this.path="";a.Branch.__super__.constructor.call(this,m);this.contents=new c.ItemContents(this)},_service:function(){return this.parent._service()+"/branches/"+this.name},_setData:function(e){if(e.commit){if(!this.head_commit||this.head_commit.sha!=e.commit.sha){this.head_commit=new a.Commit({sha:e.commit.sha},this)}this.head_commit._setData(e.commit);delete e.commit}a.Branch.__super__._setData.call(this,e)}});c.RepositoryBranches=c._Base.extend({_service:function(){return this.parent._service()+"/branches"},_prepareItem:function(e){return new a.Branch(e,this.parent)}});a.Repository=g.extend({constructor:function(e,n,o,m){if(e&&n){this.name=e;this.user=n}else{throw"name && user !"}this.parent=m||null;a.Repository.__super__.constructor.call(this,o);this.readme="";this.readmeFetcher=new b(this);this.contributors=new c.RepositoryContributors(this);this.forks=new c.RepositoryForks(this);this.stargazers=new c.RepositoryStargazers(this);this.events=new c.RepositoryEvents(this);this.branches=new c.RepositoryBranches(this)},path:function(){return this.user.login+"/"+this.name},_service:function(){return"repos/"+this.path()},fetchReadme:function(m,e){this.readmeFetcher.fetch(m,e)},_setData:function(e){if(e){if(e.owner){this.user._setData(e.owner);delete e.owner}if(e.source){if(!this.source){this.source=new a.Repository(e.source.name,new a.User(e.source.owner.login,e.source.owner))}this.source._setData(e.source);delete e.source}if(e.parent){if(!this.parent){this.parent=new a.Repository(e.parent.name,new a.User(e.parent.owner.login,e.parent.owner))}this.parent._setData(e.parent);delete e.parent}}a.Repository.__super__._setData.call(this,e)}});b=d.extend({constructor:function(e){this.repository=e;b.__super__.constructor.call(this)},_service:function(){return this.repository._service()+"/readme"},_onFetchSuccess:function(m,e){this.repository.readme=e.data;this.fetched=true;if(m){m(null,this.repository)}},_defaultFetchCallParams:function(){var e=b.__super__._defaultFetchCallParams.call(this);e.dataType="html";e.headers=$.extend({},e.headers||{},{Accept:"application/vnd.github.html+json","Content-Type":"text/html"});return e}});c._RepositoriesList=c._Base.extend({_prepareItem:function(m){var e=new a.User(m.owner.login,m.owner);return new a.Repository(m.name,e,m)}});c.UserRepositories=c._RepositoriesList.extend({_service:function(){return this.parent._service()+"/repos"}});c.UserStarredRepositories=c._RepositoriesList.extend({_service:function(){return this.parent._service()+"/starred"}});c.RepositoryForks=c._RepositoriesList.extend({_prepareItem:function(m){var e=new a.User(m.owner.login,m.owner);return new a.Repository(m.name,e,m,this.parent)},_service:function(){return this.parent._service()+"/forks"}});c.Search=c._Base.extend({constructor:function(e){this.keyword=e||null;c.Search.__super__.constructor.call(this,null)},search:function(m,n,e){this.list=[];this.keyword=m;this.fetch(n,e)}});a.Repository.Search=c.Search.extend({_service:function(){return"legacy/repos/search/"+this.keyword},_prepareItem:function(m){var e=new a.User(m.owner);delete m.owner;delete m.username;return new a.Repository(m.name,e,m)},_onFetchSuccess:function(m,e){this.fetched=true;this._setItems(e.data.repositories);if(m){m(null,this)}}});a.User.Search=c.Search.extend({_service:function(){return"legacy/user/search/"+this.keyword},_prepareItem:function(e){return new a.User(e.login,e)},getByLogin:function(e){return this.getBy("login",e)},_onFetchSuccess:function(m,e){this.fetched=true;this._setItems(e.data.users);if(m){m(null,this)}}})}).call(this);