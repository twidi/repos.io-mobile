(function(){var j=this,a,i,c,k,g,d,b,f;if(typeof exports!=="undefined"){a=exports}else{a=j.Gh3={}}a.VERSION="0.0.7";i=function(){};i.inherits=function(l,e,n){var p,m=function(){},o=function(q,r){for(var s in r){q[s]=r[s]}};if(e&&e.hasOwnProperty("constructor")){p=e.constructor}else{p=function(){l.apply(this,arguments)}}o(p,l);m.prototype=l.prototype;p.prototype=new m();if(e){o(p.prototype,e)}if(n){o(p,n)}p.prototype.constructor=p;p.__super__=l.prototype;return p};i.extend=function(e,l){var m=i.inherits(this,e,l);m.extend=this.extend;return m};if(!j.Base64){f={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decode:function(m){var e="";var t,r,p;var s,q,o,n;var l=0;m=m.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<m.length){s=this._keyStr.indexOf(m.charAt(l++));q=this._keyStr.indexOf(m.charAt(l++));o=this._keyStr.indexOf(m.charAt(l++));n=this._keyStr.indexOf(m.charAt(l++));t=(s<<2)|(q>>4);r=((q&15)<<4)|(o>>2);p=((o&3)<<6)|n;e=e+String.fromCharCode(t);if(o!=64){e=e+String.fromCharCode(r)}if(n!=64){e=e+String.fromCharCode(p)}}e=f._utf8_decode(e);return e},encode:function(m){var e="";var t,r,p,s,q,o,n;var l=0;m=f._utf8_encode(m);while(l<m.length){t=m.charCodeAt(l++);r=m.charCodeAt(l++);p=m.charCodeAt(l++);s=t>>2;q=((t&3)<<4)|(r>>4);o=((r&15)<<2)|(p>>6);n=p&63;if(isNaN(r)){o=n=64}else{if(isNaN(p)){n=64}}e=e+this._keyStr.charAt(s)+this._keyStr.charAt(q)+this._keyStr.charAt(o)+this._keyStr.charAt(n)}return e},_utf8_decode:function(e){var l="";var m=0;var n=c1=c2=0;while(m<e.length){n=e.charCodeAt(m);if(n<128){l+=String.fromCharCode(n);m++}else{if((n>191)&&(n<224)){c2=e.charCodeAt(m+1);l+=String.fromCharCode(((n&31)<<6)|(c2&63));m+=2}else{c2=e.charCodeAt(m+1);c3=e.charCodeAt(m+2);l+=String.fromCharCode(((n&15)<<12)|((c2&63)<<6)|(c3&63));m+=3}}}return l},_utf8_encode:function(l){l=l.replace(/\r\n/g,"\n");var e="";for(var o=0;o<l.length;o++){var m=l.charCodeAt(o);if(m<128){e+=String.fromCharCode(m)}else{if((m>127)&&(m<2048)){e+=String.fromCharCode((m>>6)|192);e+=String.fromCharCode((m&63)|128)}else{e+=String.fromCharCode((m>>12)|224);e+=String.fromCharCode(((m>>6)&63)|128);e+=String.fromCharCode((m&63)|128)}}}return e}};j.Base64=f}a.Base64=j.Base64;if(window.XDomainRequest){try{new XDomainRequest();$.support.cors=true;$.ajaxSetup.xhr=function(){return new XDomainRequest()}}catch(h){}}a.Helper=i.extend({},{protocol:"https",domain:"api.github.com",headers:{Origin:location.host,Accept:"application/vnd.github+json","Content-Type":"application/json"},dataType:"json",cache:true,callHttpApi:function(e){e.url=a.Helper.protocol+"://"+a.Helper.domain+"/"+e.service;if($.support.cors){e.headers=$.extend({},a.Helper.headers,e.headers||{});if(!e.dataType){e.dataType=a.Helper.dataType}if(!e.cache&&e.cache!==false){e.cache=a.Helper.cache}var l=e.success;if($.isFunction(l)){e.success=function(n,o,m){l.call(this,{data:n},o,m)}}}else{e.dataType="jsonp"}$.ajax(e)}});d=i.extend({constructor:function(){this.fetched=false},_setData:function(e){if(!e){return}for(var l in e){this[l]=e[l]}},_onFetchSuccess:function(l,e){this.fetched=true;if(l){l(null,this)}},_onFetchError:function(l,e){if(l){l(e)}},_service:function(){throw ("Undefined service")},_defaultFetchCallParams:function(){return{}},_preFetch:function(l,e){},fetch:function(p,l){var m=this,e,o,n;m._preFetch(p,l);o={service:m._service(),success:function(q){m._onFetchSuccess(p,q)},error:function(q){m._onFetchError(p,q)}};e=m._defaultFetchCallParams();if(l){e.data=$.extend({},e.data||{},l)}a.Helper.callHttpApi($.extend({},e,o))}});g=d.extend({constructor:function(e){g.__super__.constructor.call(this);this._setData(e)},_onFetchSuccess:function(l,e){this._setData(e.data);g.__super__._onFetchSuccess.call(this,l,e)}});c={};c._Base=d.extend({constructor:function(e){this.parent=e;this.list=[];c._Base.__super__.constructor.call(this)},length:function(){return this.list.length},reverse:function(){this.list.reverse()},sort:function(e){if(e){this.list.sort(e)}else{this.list.sort()}},getAll:function(){return this.list},filterBy:function(l,e){return _.filter(this.list,function(m){return m[l]==e},this)},getBy:function(l,e){return _.find(this.list,function(m){return m[l]==e},this)},getByName:function(e){return this.getBy("name",e)},each:function(e){_.each(this.list,e)},_onFetchSuccess:function(l,e){this.fetched=true;this._setItems(e.data);if(l){l(null,this.parent)}},_prepareItem:function(e){return e},_addItem:function(e){this.list.push(this._prepareItem(e))},_addItems:function(e){var l=this;_.each(e,function(m){l._addItem(m)})},_setItems:function(e){this.list=[];this._addItems(e)}});a.User=g.extend({constructor:function(e,l){if(e){this.login=e}else{throw"login !"}a.User.__super__.constructor.call(this,l);this.repositories=new c.UserRepositories(this);this.members=new c.OrganizationMembers(this);this.orgs=new c.UserOrganizations(this);this.followers=new c.UserFollowers(this);this.following=new c.UserFollowing(this);this.starred=new c.UserStarredRepositories(this);this.events=new c.UserEvents(this);this.received_events=new c.UserReceivedEvents(this);this.gists=new c.UserGists(this)},_service:function(){return"users/"+this.login},_setData:function(e){if(e){if(typeof e.followers!=="undefined"){e.followers_count=e.followers;delete e.followers}if(typeof e.following!=="undefined"){e.following_count=e.following;delete e.following}}a.User.__super__._setData.call(this,e)}});c._UsersList=c._Base.extend({_prepareItem:function(e){return new a.User(e.login,e)},getByLogin:function(e){return this.getBy("login",e)}});c.OrganizationMembers=c._UsersList.extend({_service:function(){return"orgs/"+this.parent.login+"/members"}});c.UserOrganizations=c._UsersList.extend({_service:function(){return this.parent._service()+"/orgs"}});c.UserFollowers=c._UsersList.extend({_service:function(){return this.parent._service()+"/followers"}});c.UserFollowing=c._UsersList.extend({_service:function(){return this.parent._service()+"/following"}});c.RepositoryContributors=c._UsersList.extend({_service:function(){return this.parent._service()+"/contributors"}});c.RepositoryStargazers=c._UsersList.extend({_service:function(){return this.parent._service()+"/stargazers"}});a.CurrentUser=a.User.extend({constructor:function(){a.CurrentUser.__super__.constructor.call(this,"logged-user")},_service:function(){return"user"}});a.Event=g.extend({_setData:function(e){if(e){if(e.actor){if(e.actor.id&&e.actor.login){if(!this.actor){this.actor=new a.User(e.actor.login)}this.actor._setData(e.actor)}delete e.actor}if(e.repo){if(e.repo.id&&e.repo.name){if(!this.repository){var l=e.repo.name.split("/");this.repository=new a.Repository(l[1],new a.User(l[0]))}this.repository._setData(e.repo)}delete e.repo}}a.Event.__super__._setData.call(this,e)}});c._EventsList=c._Base.extend({_prepareItem:function(e){return new a.Event(e)}});c.UserEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/events"}});c.UserReceivedEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/received_events"}});c.RepositoryEvents=c._EventsList.extend({_service:function(){return this.parent._service()+"/events"}});a.Gist=g.extend({constructor:function(n,m,l,e){this.user=m||null;this.parent=l||null;this.version=e||null;this.files=new c.GistFiles(this);this.comments=new c.GistComments(this);this.forks=new c.GistForks(this);this.history=new c.GistHistory(this);a.Gist.__super__.constructor.call(this,n)},_setData:function(e){if(e.user){if(!this.user){this.user=new a.User(e.user.login)}this.user._setData(e.user);delete e.user}if(e.files){this.files._setItems(e.files);delete e.files}if(e.fork_of){if(!this.parent){this.parent=new a.Gist({id:e.fork_of.id},new a.User(e.fork_of.user.login,e.fork_of.user))}this.parent._setData(e.fork_of);delete e.fork_of}if(e.forks){this.history._setItems(e.forks);delete e.forks}if(e.history){this.history._setItems(e.history);delete e.history}e.comment_count=e.comments;delete e.comments;a.Gist.__super__._setData.call(this,e)},_baseService:function(){return"gists/"+this.id},_service:function(){var e=this._baseService();if(this.version){e+="/"+this.version}return e}});a.GistComment=g.extend({constructor:function(l,e){this.gist=e;a.GistComment.__super__.constructor.call(this,l)},_service:function(){return this.gist._baseService()+"/comments/"+this.id},_setData:function(e){if(e.user){if(!this.user){this.user=new a.User(e.user.login)}this.user._setData(e.user);delete e.user}a.GistComment.__super__._setData.call(this,e)}});c.GistComments=c._Base.extend({_prepareItem:function(e){return new a.GistComment(e,this.parent)},_service:function(){return this.parent._baseService()+"/comments"}});c.GistForks=c._Base.extend({_prepareItem:function(l){var e;if(l.user){e=new a.User(l.user.login,l.user)}return new a.Gist(l,e,this.parent)},_service:function(){return this.parent._baseService()+"/forks"}});c.UserGists=c._Base.extend({_prepareItem:function(e){return new a.Gist(e,this.parent)},_service:function(){return this.parent._service()+"/gists"}});a.GistFile=g.extend({constructor:function(e,l){this.gist=l;a.GistFile.__super__.constructor.call(this,e)}});c.GistFiles=c._Base.extend({_prepareItem:function(e){return new a.GistFile(e,this.parent)},getByName:function(e){return this.getBy("filename",e)}});a.GistVersion=g.extend({constructor:function(e,m,l){this.parent=l;this.version=e;this.gist=new a.Gist({id:this.parent.id},this.parent.user,null,this.version);a.GistVersion.__super__.constructor.call(this,m)}});c.GistHistory=c._Base.extend({_prepareItem:function(e){return new a.GistVersion(e.version,e,this.parent)}});k=g.extend({constructor:function(e,l){this.branch=l;k.__super__.constructor.call(this,e)},_service:function(){return this.branch.repository._service()+"/contents/"+this.path}});a.File=k.extend({constructor:function(e,l){a.File.__super__.constructor.call(this,e,l);this.commits=new c.FileCommits(this)},_service:function(){return this.branch.repository._service()+"/contents/"+this.path},_defaultFetchCallParams:function(){var e=c.ItemContents.__super__._defaultFetchCallParams.call(this);e.data=$.extend({},e.data||{},{ref:this.branch.name});return e},_onFetchSuccess:function(l,e){if(e.data.content){e.data.content=f.decode(e.data.content)}a.File.__super__._onFetchSuccess.call(this,l,e)}});a.Dir=k.extend({constructor:function(e,l){a.Dir.__super__.constructor.call(this,e,l);this.contents=new c.ItemContents(this)}});c.ItemContents=c._Base.extend({_prepareItem:function(e){return new a[e.type=="file"?"File":"Dir"](e,this.parent)},_service:function(){return this.parent.branch.repository._service()+"/contents/"+this.parent.path},_defaultFetchCallParams:function(){var e=c.ItemContents.__super__._defaultFetchCallParams.call(this);e.data=$.extend({},e.data||{},{ref:this.parent.branch.name});return e},files:function(e){return _.filter(this.list,function(l){return l.type=="file"},this)},dirs:function(e){return _.filter(this.list,function(l){return l.type=="dir"},this)},getFileByName:function(e){return _.find(this.list,function(l){return l.name==e&&l.type=="file"})},getDirByName:function(e){return _.find(this.list,function(l){return l.name==e&&l.type=="dir"})}});a.Commit=g.extend({constructor:function(l,e){this.branch=e;this.files=new c.CommitFiles(this);a.Commit.__super__.constructor.call(this,l)},_setData:function(e){if(e.author){if(!this.author){this.author=new a.User(e.author.login)}this.author._setData(e.author);delete e.author}if(e.commiter){if(!this.author||e.commiter.login!=this.author.login){if(!this.commiter){this.commiter=new a.User(e.commiter.login)}this.commiter._setData(e.commiter)}else{this.commiter=this.author}delete e.commiter}if(e.files){this.files._setItems(e.files);delete e.files}a.Commit.__super__._setData.call(this,e)}});a.CommitFile=g.extend({constructor:function(e,l){this.commit=l;a.CommitFile.__super__.constructor.call(this,e)},_setData:function(l){var e={sha:l.sha,filename:l.filename};if(!this.file){this.file=new a.File(e,this.commit.branch)}else{this.file._setData(e)}a.CommitFile.__super__._setData.call(this,l)}});c.CommitFiles=c._Base.extend({_prepareItem:function(e){return new a.CommitFile(e,this.parent)},getByName:function(e){return this.getBy("filename",e)}});c._Commits=c._Base.extend({_service:function(){return this.parent.branch.repository._service()+"/commits"},_prepareItem:function(e){return new a.Commit(e,this.parent.branch)},last:function(){return this.list[0]},first:function(){return this.list[this.list.length-1]}});c.FileCommits=c._Commits.extend({_defaultFetchCallParams:function(m,e){var l=c.FileCommits.__super__._defaultFetchCallParams.call(this,m,e);l.data=$.extend({},l.data||{},{path:this.parent.path});return l}});c.BranchCommits=c._Commits.extend({_defaultFetchCallParams:function(m,e){var l=c.FileCommits._defaultFetchCallParams.call(this,m,e);l.data=$.extend({},l.data||{},{ref:this.parent.name});return l}});a.Branch=g.extend({constructor:function(l,e){this.repository=e;this.branch=this;this.path="";a.Branch.__super__.constructor.call(this,l);this.contents=new c.ItemContents(this)},_service:function(){return this.parent._service()+"/branches/"+this.name},_setData:function(e){if(e.commit){if(!this.head_commit||this.head_commit.sha!=e.commit.sha){this.head_commit=new a.Commit({sha:e.commit.sha},this)}this.head_commit._setData(e.commit);delete e.commit}a.Branch.__super__._setData.call(this,e)}});c.RepositoryBranches=c._Base.extend({_service:function(){return this.parent._service()+"/branches"},_prepareItem:function(e){return new a.Branch(e,this.parent)}});a.Repository=g.extend({constructor:function(e,m,n,l){if(e&&m){this.name=e;this.user=m}else{throw"name && user !"}this.parent=l||null;a.Repository.__super__.constructor.call(this,n);this.readme="";this.readmeFetcher=new b(this);this.contributors=new c.RepositoryContributors(this);this.forks=new c.RepositoryForks(this);this.stargazers=new c.RepositoryStargazers(this);this.events=new c.RepositoryEvents(this);this.branches=new c.RepositoryBranches(this)},_service:function(){return"repos/"+this.user.login+"/"+this.name},fetchReadme:function(l,e){this.readmeFetcher.fetch(l,e)},_setData:function(e){if(e){if(e.owner){this.user._setData(e.owner);delete e.owner}if(e.source){if(!this.source){this.source=new a.Repository(e.source.name,new a.User(e.source.owner.login,e.source.owner))}this.source._setData(e.source);delete e.source}if(e.parent){if(!this.parent){this.parent=new a.Repository(e.parent.name,new a.User(e.parent.owner.login,e.parent.owner))}this.parent._setData(e.parent);delete e.parent}}a.Repository.__super__._setData.call(this,e)}});b=d.extend({constructor:function(e){this.repository=e;b.__super__.constructor.call(this)},_service:function(){return this.repository._service()+"/readme"},_onFetchSuccess:function(l,e){this.repository.readme=e.data;this.fetched=true;if(l){l(null,this.repository)}},_defaultFetchCallParams:function(){var e=b.__super__._defaultFetchCallParams.call(this);e.dataType="html";e.headers=$.extend({},e.headers||{},{Accept:"application/vnd.github.html+json","Content-Type":"text/html"});return e}});c._RepositoriesList=c._Base.extend({_prepareItem:function(l){var e=new a.User(l.owner.login,l.owner);return new a.Repository(l.name,e,l)}});c.UserRepositories=c._RepositoriesList.extend({_service:function(){return this.parent._service()+"/repos"}});c.UserStarredRepositories=c._RepositoriesList.extend({_service:function(){return this.parent._service()+"/starred"}});c.RepositoryForks=c._RepositoriesList.extend({_prepareItem:function(l){var e=new a.User(l.owner.login,l.owner);return new a.Repository(l.name,e,l,this.parent)},_service:function(){return this.parent._service()+"/forks"}});c.Search=c._Base.extend({constructor:function(e){this.keyword=e||null;c.Search.__super__.constructor.call(this,null)},search:function(l,m,e){this.list=[];this.keyword=l;this.fetch(m,e)}});a.Repository.Search=c.Search.extend({_service:function(){return"legacy/repos/search/"+this.keyword},_prepareItem:function(l){var e=new a.User(l.owner);delete l.owner;delete l.username;return new a.Repository(l.name,e,l)},_onFetchSuccess:function(l,e){this.fetched=true;this._setItems(e.data.repositories);if(l){l(null,this)}}});a.User.Search=c.Search.extend({_service:function(){return"legacy/user/search/"+this.keyword},_prepareItem:function(e){return new a.User(e.login,e)},getByLogin:function(e){return this.getBy("login",e)},_onFetchSuccess:function(l,e){this.fetched=true;this._setItems(e.data.users);if(l){l(null,this)}}})}).call(this);